<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zenith Prime | Unified Fire Suite</title>
    <script src="https://cdn.jsdelivr.net/npm/webadb@0.0.10/dist/webadb.min.js"></script>
    <style>
        :root { --amazon: #ff9900; --bg: #0d1117; --card: #161b22; --text: #c9d1d9; --accent: #58a6ff; --danger: #f85149; --success: #3fb950; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; }
        nav { background: #010409; display: flex; justify-content: center; border-bottom: 1px solid #30363d; position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .tab-btn { background: none; border: none; color: #8b949e; padding: 15px 20px; cursor: pointer; font-weight: bold; transition: 0.2s; border-bottom: 2px solid transparent; font-size: 0.9em; }
        .tab-btn:hover { color: var(--text); }
        .tab-btn.active { color: var(--amazon); border-bottom: 2px solid var(--amazon); }
        .container { max-width: 1000px; margin: 20px auto; padding: 0 20px; }
        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .card { background: var(--card); border-radius: 12px; padding: 25px; border: 1px solid #30363d; margin-bottom: 20px; }
        h2 { color: var(--amazon); margin-top: 0; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; }
        button { background: var(--amazon); color: #000; border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%; margin: 5px 0; transition: 0.2s; }
        button:hover { filter: brightness(1.1); transform: scale(1.01); }
        button:disabled { background: #21262d; color: #484f58; cursor: not-allowed; }
        .btn-blue { background: var(--accent); color: white; }
        .btn-red { background: var(--danger); color: white; }
        .btn-outline { background: transparent; border: 1px solid #30363d; color: #8b949e; }
        #log { background: #000; color: #39ff14; padding: 15px; height: 160px; overflow-y: auto; font-family: 'Consolas', monospace; border-radius: 8px; border: 1px solid #30363d; margin-top: 20px; font-size: 13px; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; text-align: center; margin-bottom: 20px; background: #0d1117; padding: 15px; border-radius: 8px; }
        .stat-val { font-size: 1.2em; font-weight: bold; color: var(--success); }
    </style>
</head>
<body>

<nav>
    <button class="tab-btn active" onclick="openTab(event, 'dash')">DASHBOARD</button>
    <button class="tab-btn" onclick="openTab(event, 'performance')">PERFORMANCE</button>
    <button class="tab-btn" onclick="openTab(event, 'kindle')">KINDLE</button>
    <button class="tab-btn" onclick="openTab(event, 'recovery')">RECOVERY</button>
</nav>

<div class="container">
    <div id="dash" class="tab-content active">
        <div class="card">
            <h2>Zenith Connection</h2>
            <div id="lib-status" style="text-align:center; color: #888; margin-bottom: 10px; font-size: 0.8em;">Syncing Drivers...</div>
            <div class="stats-grid">
                <div><div style="font-size: 0.7em; color: #8b949e;">BATTERY</div><div id="stat-batt" class="stat-val">--</div></div>
                <div><div style="font-size: 0.7em; color: #8b949e;">RAM FREE</div><div id="stat-ram" class="stat-val">--</div></div>
                <div><div style="font-size: 0.7em; color: #8b949e;">STATUS</div><div id="stat-conn" class="stat-val" style="color:var(--danger)">OFFLINE</div></div>
            </div>
            <button id="connect" disabled style="background:var(--success); color:white;">INITIALIZE USB LINK</button>
        </div>
        
        <div class="grid">
            <div class="card">
                <h3>Sideload Engine</h3>
                <input type="file" id="apk-file" style="font-size: 0.8em; margin-bottom: 10px;">
                <button class="tool" disabled onclick="installAPK()">Push & Install APK</button>
            </div>
            <div class="card">
                <h3>Project Info</h3>
                <button class="btn-outline" onclick="window.open('https://github.com/mpetschelmedia/fire-manager', '_blank')">View GitHub Repo</button>
                <button class="btn-outline" onclick="window.open('https://github.com/mpetschelmedia/fire-manager/issues', '_blank')">Report an Issue</button>
            </div>
        </div>
    </div>

    <div id="performance" class="tab-content">
        <div class="grid">
            <div class="card">
                <h3>Speed & UI</h3>
                <button class="tool" disabled onclick="runCmd('settings put global window_animation_scale 0.5; settings put global transition_animation_scale 0.5')">High-Speed Animations</button>
                <button class="tool" disabled onclick="runCmd('wm density 240')">Zenith DPI (High-Res)</button>
                <button class="tool" disabled onclick="runCmd('pm trim-caches 999G')">⚡ Force Cache Trim</button>
            </div>
            <div class="card">
                <h3>Optimization</h3>
                <button class="tool btn-red" disabled onclick="massDebloat()">Run Master Purge</button>
                <button class="tool" disabled onclick="runCmd('pm uninstall --user 0 com.amazon.firelauncher')">Disable Fire Launcher</button>
                <button class="tool" disabled onclick="runCmd('pm uninstall --user 0 com.amazon.device.software.ota')">Block OTA Updates</button>
            </div>
        </div>
    </div>

    <div id="kindle" class="tab-content">
        <div class="card">
            <h2>Bibliophile Suite</h2>
            <button class="tool" disabled onclick="runCmd('pm uninstall --user 0 com.amazon.kindle.kso')">Remove Lockscreen Ads</button>
            <button class="tool" disabled onclick="runCmd('pm install-existing com.amazon.kindle')">Verify Kindle Reader App</button>
        </div>
    </div>

    <div id="recovery" class="tab-content">
        <div class="card">
            <h2>Emergency Tools</h2>
            <button class="tool btn-blue" disabled onclick="restoreAll()">Full Factory Restoration</button>
            <button class="tool btn-red" disabled onclick="runCmd('reboot recovery')">Force Recovery Mode</button>
            <button class="tool btn-outline" disabled onclick="runCmd('reboot')">System Restart</button>
        </div>
    </div>

    <div id="log">Console: Waiting for drivers...</div>
</div>

<script>
    let adb, device;
    const logEl = document.getElementById('log');
    function log(m) { 
        const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
        logEl.innerHTML += `<div><span style="color:#555">[${time}]</span> ${m}</div>`; 
        logEl.scrollTop = logEl.scrollHeight; 
    }

    window.onload = () => {
        if (typeof WebADB !== 'undefined') {
            document.getElementById('lib-status').innerText = "✅ Drivers Ready";
            document.getElementById('lib-status').style.color = "var(--success)";
            document.getElementById('connect').disabled = false;
            log("System initialized for mpetschelmedia.");
        } else {
            document.getElementById('lib-status').innerText = "⚠️ Driver Error: Retrying...";
            setTimeout(() => location.reload(), 3000);
        }
    };

    function openTab(evt, tabName) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabName).classList.add('active');
        evt.currentTarget.classList.add('active');
    }

    document.getElementById('connect').onclick = async () => {
        try {
            const webadb = new WebADB();
            device = await webadb.decode(await navigator.usb.requestDevice({ filters: [] }));
            await device.connect();
            adb = await device.shell();
            document.getElementById('stat-conn').innerText = "ONLINE";
            document.getElementById('stat-conn').style.color = "var(--success)";
            document.querySelectorAll('.tool').forEach(b => b.disabled = false);
            log("Zenith Link Established.");
            updateStats();
        } catch (e) { log("Connection Failed: " + e.message); }
    };

    async function updateStats() {
        if(!adb) return;
        try {
            const batt = await adb.execute("dumpsys battery | grep level");
            const mem = await adb.execute("free -m | grep Mem");
            document.getElementById('stat-batt').innerText = batt.split(":")[1].trim() + "%";
            document.getElementById('stat-ram').innerText = mem.split(/\s+/)[3] + "MB";
        } catch(e) {}
    }

    async function runCmd(c) { log("Sending: " + c); await adb.execute(c); log("Accepted."); }

    async function massDebloat() {
        const targets = ["com.amazon.dee.app", "com.amazon.avod", "com.amazon.mp3", "com.amazon.photos", "com.amazon.windowshop", "com.amazon.cloud9", "com.amazon.vizzini"];
        for(let p of targets) { log("Nuking: " + p); await adb.execute(`pm uninstall --user 0 ${p}`); }
        log("Optimization Complete.");
    }

    async function restoreAll() {
        const apps = ["com.amazon.dee.app", "com.amazon.avod", "com.amazon.mp3", "com.amazon.photos", "com.amazon.windowshop", "com.amazon.venezia", "com.amazon.kindle", "com.amazon.firelauncher", "com.amazon.kindle.cms"];
        for(let p of apps) { log("Restoring: " + p); await adb.execute(`pm install-existing ${p}`); }
    }

    async function installAPK() {
        const file = document.getElementById('apk-file').files[0];
        if(!file) return alert("Select APK.");
        log(`Uploading: ${file.name}`);
        const reader = new FileReader();
        reader.onload = async (e) => {
            const sync = await device.sync();
            await sync.push(new Uint8Array(e.target.result), `/data/local/tmp/tmp.apk`);
            await sync.quit();
            await adb.execute("pm install -r /data/local/tmp/tmp.apk");
            log("Install Success.");
        };
        reader.readAsArrayBuffer(file);
    }
</script>
</body>
</html>
